# coding: utf-8


import scipy.io
import numpy as np
import matplotlib.pyplot as plt
# from colour_func import RGB_10_degree_cmfs_to_XYZ_10_degree_cmfs
from colour.colorimetry import transformations
from utils import normalize


func_name = transformations.RGB_10_degree_cmfs_to_XYZ_10_degree_cmfs

start_wave = 400
last_wave = 700
data_name = 'dataset/icvl/mat/icvl.mat'
x = np.arange(start_wave, last_wave + 1, 10)
# RGB_10_degree_cmfs_to_XYZ_10_degree_cmfs(700)

data = normalize(scipy.io.loadmat(data_name)['data'])
print(data.shape)
# trans_filter = transformations.RGB_10_degree_cmfs_to_LMS_10_degree_cmfs(x)
trans_filter = func_name(x)
x = np.array([
[[  9.73192501,   5.02105851,   3.22790699], [ 16.08032168,  24.47303359,  10.28681006], [ 17.73513774,  29.61865582,  12.10713449]],
[[ 25.69298792,  11.72611193,   3.70187275], [ 18.51208526,   8.03720984,   9.30361825], [ 48.55945054,  32.30885571,   4.09223401]],
[[  5.7743232 ,  10.10692925,  10.08461311], [  8.81306527,   3.65394599,   4.20783881], [  8.06007398,  15.87077693,   7.02551086]],
[[90.88877129, 81.82966846, 29.86765971], [38.64801062, 26.70860262, 15.08396538], [8.77151115, 10.56330761, 4.28940206]]
])
print(x.shape)
msds = np.array([
     [[0.01367208, 0.09127947, 0.01524376, 0.02810712, 0.19176012, 0.04299992],
      [0.00959792, 0.25822842, 0.41388571, 0.22275120, 0.00407416, 0.37439537],
      [0.01791409, 0.29707789, 0.56295109, 0.23752193, 0.00236515, 0.58190280]],
     [[0.01492332, 0.10421912, 0.02240025, 0.03735409, 0.57663846, 0.32416266],
      [0.04180972, 0.26402685, 0.03572137, 0.00413520, 0.41808194, 0.24696727],
      [0.00628672, 0.11454948, 0.02198825, 0.39906919, 0.63640803, 0.01139849]],
     [[0.04325933, 0.26825359, 0.23732357, 0.05175860, 0.01181048, 0.08233768],
      [0.02484169, 0.12027161, 0.00541695, 0.00654612, 0.18603799, 0.36247808],
      [0.03102159, 0.16815442, 0.37186235, 0.08610666, 0.00413520, 0.78492409]],
     [[0.11682307, 0.78883040, 0.74468607, 0.83375293, 0.90571451, 0.70054168],
      [0.06321812, 0.41898224, 0.15190357, 0.24591440, 0.55301750, 0.00657664],
      [0.00305180, 0.11288624, 0.11357290, 0.12924391, 0.00195315, 0.21771573]],
 ])
print(msds.shape)
trans_data = normalize(data.dot(trans_filter))
print(trans_data.shape)
show_data = trans_data[:512, :512, (2, 1, 0)]
plt.imshow(show_data)
plt.show()